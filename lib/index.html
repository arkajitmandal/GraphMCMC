<html>
<head>
        <link rel="stylesheet" href="style.css">
        
        <script src="index.js"></script>
        <script>
        
        


var Nodes = [];
var Edges = [];
var Lock = false;


function drawNode(x, y, fill = "#ff005b") {
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  var centerX = x;
  var centerY = y;
  var radius = 5;
  context.beginPath();
  context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
  context.fillStyle = fill;
  context.fill();
  context.lineWidth = 5;
  context.strokeStyle = fill;
  context.shadowColor = fill;
  context.shadowBlur = 5;
  context.shadowOffsetX = 0;
  context.shadowOffsetY = 0;
  context.stroke();
}

var clr = function() {
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  context.clearRect(0, 0, canvas.width, canvas.height);
  Nodes = [];
  Lock = false;
};

function addNode(evt) {
  if (!Lock){
  var canvas = document.getElementById("myCanvas");
  var mousePos = getMousePos(canvas, evt);
  if (Nodes.length === 0) {
    drawNode(mousePos.x, mousePos.y);
  } else {
    drawNode(mousePos.x, mousePos.y, "#00E676");
  }
  Nodes.push([mousePos.x, mousePos.y]);
}
}


function canvasEvt(evt) {
  if (!Lock){
  var canvas = document.getElementById("myCanvas");
  var mousePos = getMousePos(canvas, evt);
  if (Nodes.length === 0) {
    drawNode(mousePos.x, mousePos.y);
  } else {
    drawNode(mousePos.x, mousePos.y, "#00E676");
  }
  Nodes.push([mousePos.x, mousePos.y]);
}
}



function getMousePos(canvas, evt) {
  var rect = canvas.getBoundingClientRect();
  return {
    x: evt.clientX - rect.left,
    y: evt.clientY - rect.top
  };
}
function drawEdge(x1,y1,x2,y2,fill='#00E676'){
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  context.beginPath();
  context.moveTo(x1,y1);
   context.lineTo(x2,y2);
    context.lineWidth = 2;
  context.strokeStyle = "#69F0AE";
  context.shadowColor = fill;
  context.shadowBlur = 10;
  context.shadowOffsetX = 0;
  context.shadowOffsetY = 0;
  context.stroke();
}

async function start(){
  //Button Activate
  document.getElementById('canvasInactive').id = 'canvasActive';
  //clean
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  context.clearRect(0, 0, canvas.width, canvas.height);
  //makeGraph
  let nowG = new Graph();
  nowG.addNode(new Node(Nodes[0][0], Nodes[0][1]));
  for(var i=1;i<Nodes.length;i++){
    nowG.addNode(new Node(Nodes[i][0], Nodes[i][1]));
  }
  for(var i=1;i<nowG.Nodes.length;i++){
    nowG.addEdge(new Edge(nowG.Nodes[0],nowG.Nodes[i]));
  }
  
  drawGraph(nowG);
  let cc=0;
  var wG = proposeGraph(nowG);
  while (cc<1000){
    wG = proposeGraph(wG);
    await sleep(100);
    drawGraph(wG);
    cc++;
  }
}
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}


function drawGraph(dG){
  //clean
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  context.clearRect(0, 0, canvas.width, canvas.height);
  //disable add
  Lock = true;
  let GNodes = dG.Nodes;
  let GEdges = dG.Edges;
  //DrawEdges
  for(var i=0;i<GEdges.length;i++){
  let Node1 = GEdges[i].nodes[0];
  let Node2 = GEdges[i].nodes[1];
  drawEdge(Node1.x,Node1.y,Node2.x,Node2.y);
  }
  //DrawNodes
   drawNode(GNodes[0].x, GNodes[0].y);
   for(var i=1;i<GNodes.length;i++){
    drawNode(GNodes[i].x, GNodes[i].y, "#00E676");
   }
 }


        
        </script>
</head>

<body>

    <canvas onclick="addNode(event);" id="myCanvas" width="900" height="400" ></canvas>
    
    <button onclick='start();' style="margin-top:20px;height:40px" id='canvasInactive'>
    Start
    </button>
    
    <button onclick='clr();' style="margin-top:20px;">
    Reset
    </button>

</body>


</html>