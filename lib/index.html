<html>
<head>
        <link rel="stylesheet" href="style.css">
        
        <script src="index.js"></script>
        <script>
        
        


var Nodes = [];
var Edges = [];
var Lock = false;
var run = true;
var pause =false;
var graphExist = false;
var nowG;
var T = 1000;
var blue = '#2196F3';
var red = '#ff005b';
var green = '#00E676'
function drawNode(x, y, fill = "#ff005b") {
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  var centerX = x;
  var centerY = y;
  var radius = 5;
  context.beginPath();
  context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
  context.fillStyle = fill;
  context.fill();
  context.lineWidth = 5;
  context.strokeStyle = fill;
  context.shadowColor = fill;
  context.shadowBlur = 5;
  context.shadowOffsetX = 0;
  context.shadowOffsetY = 0;
  context.stroke();
}

async function clr() {
  run = false; 
  await sleep(100);  
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  context.clearRect(0, 0, canvas.width, canvas.height);
  Nodes = [];
  Lock = false;
  graphExist = false;
  pause =false;
  try {
  document.getElementById('canvasActive').id = 'canvasInactive';
  document.getElementById('canvasInactive').innerHTML = "Start &#9658;";}
  catch(err){
      document.getElementById('canvasInactive').innerHTML = "Start &#9658;";
  }
};

function addNode(evt) {
  if (!Lock){
  var canvas = document.getElementById("myCanvas");
  var mousePos = getMousePos(canvas, evt);
  if (Nodes.length === 0) {
    drawNode(mousePos.x, mousePos.y);
  } else {
    drawNode(mousePos.x, mousePos.y, "#00E676");
  }
  Nodes.push([mousePos.x, mousePos.y]);
}
}


function canvasEvt(evt) {
  if (!Lock){
  var canvas = document.getElementById("myCanvas");
  var mousePos = getMousePos(canvas, evt);
  if (Nodes.length === 0) {
    drawNode(mousePos.x, mousePos.y);
  } else {
    drawNode(mousePos.x, mousePos.y, "#00E676");
  }
  Nodes.push([mousePos.x, mousePos.y]);
}
}



function getMousePos(canvas, evt) {
  var rect = canvas.getBoundingClientRect();
  return {
    x: evt.clientX - rect.left,
    y: evt.clientY - rect.top
  };
}
function drawEdge(x1,y1,x2,y2,fill='#00E676'){
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  context.beginPath();
  context.moveTo(x1,y1);
   context.lineTo(x2,y2);
    context.lineWidth = 2;
  context.strokeStyle = fill; 
  context.shadowColor = fill;
  context.shadowBlur = 10;
  context.shadowOffsetX = 0;
  context.shadowOffsetY = 0;
  context.stroke();
}

async function start(){
  if (pause){
      pause=false;
      run = false;
      document.getElementById('canvasActive').innerHTML = "Start &#9658;";
  }
  else {
  run =true;
  pause = true;
  //Button Activate
  document.getElementById('canvasInactive').id = 'canvasActive';
  document.getElementById('canvasActive').innerHTML = "Pause &#10073;&#10073;";
  //clean
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  context.clearRect(0, 0, canvas.width, canvas.height);
  //makeGraph
  if (!graphExist){
    console.log("Creating")
    nowG = new Graph();
    nowG.addNode(new Node(Nodes[0][0], Nodes[0][1]));
    for(var i=1;i<Nodes.length;i++){
      nowG.addNode(new Node(Nodes[i][0], Nodes[i][1]));
    }
    for(var i=1;i<nowG.Nodes.length;i++){
    nowG.addEdge(new Edge(nowG.Nodes[0],nowG.Nodes[i]));
    }
    graphExist = true;
    }
  if (nowG !== undefined)  {
  drawGraph(nowG);

  nowG = proposeGraph(nowG);
  while (run){
    let newG = proposeGraph(nowG);
    if (monteCarlo(getProbability(nowG,newG,T))){
    await sleep(100);
    drawGraph(newG);
    nowG = newG;
    }
  }
}
  document.getElementById('canvasActive').id = 'canvasInactive';
}

}
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

function setT(){
    T = document.getElementsByName('T')[0].value;
}

function drawGraph(dG){
  //clean
  var canvas = document.getElementById("myCanvas");
  var context = canvas.getContext("2d");
  context.clearRect(0, 0, canvas.width, canvas.height);
  //disable add
  Lock = true;
  let GNodes = dG.Nodes;
  let GEdges = dG.Edges;
  //DrawEdges
  for(var i=0;i<GEdges.length;i++){

  let Node1 = GEdges[i].nodes[0];
  let Node2 = GEdges[i].nodes[1];
  let col = green;
  if (Node1.id === GNodes[0].id || Node2.id === GNodes[0].id){
    col = red;
  }
  drawEdge(Node1.x,Node1.y,Node2.x,Node2.y,col);
  }
  //DrawNodes
   drawNode(GNodes[0].x, GNodes[0].y);
   for(var i=1;i<GNodes.length;i++){
    drawNode(GNodes[i].x, GNodes[i].y, green);
   }
 }


        
        </script>






</head>

<body>

    <canvas onclick="addNode(event);" id="myCanvas" width="900" height="400" ></canvas>
    
    <button onclick='start();' style="margin-top:20px;height:40px" id='canvasInactive'>
    Start &#9658;
    </button>
    
    <button onclick='clr();' style="margin-top:20px;height:40px">
    Reset &#x21bb;
    </button>
    <br>
    <label for="T">T</label>
<input type='text' value='1000' name='T' onkeyup="setT();"/> 
</body>


</html>